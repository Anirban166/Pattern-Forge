<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Shirt Pattern</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: white;
      overflow: hidden;
    }

    header {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      font-size: 28px;
      font-weight: bold;
    }

    .controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .control-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 16px;
    }

    .control-group label {
      width: 120px;
      color: #ddd;
    }

    .control-group input,
    .control-group select {
      width: 150px;
    }

    .measurement {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 8px;
    }

    .zoom-buttons {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
      display: flex;
      flex-direction: column;
    }

    .zoom-button {
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      cursor: pointer;
      border: none;
      font-size: 18px;
      line-height: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 40px;
      height: 40px;
    }

    .zoom-button:hover {
      background-color: rgba(0, 0, 0, 0.9);
    }
  </style>

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.153.0/examples/jsm/"
      }
    }
  </script>
</head>
<body>
  <header>3D Parametric Shirt Pattern</header>
  <canvas id="canvas"></canvas>

  <div class="controls">
    <div class="control-group">
      <label for="patternPreset">Pattern Preset</label>
      <select id="patternPreset">
        <option value="basic">Basic Shirt</option>
        <option value="shirtWithCollar">Shirt with Collar</option>
        <option value="shirtWithSleeves">Shirt with Sleeves</option>
        <option value="shirtWithYoke">Shirt with Yoke</option>
      </select>
    </div>
    <div class="control-group">
      <label for="width">Width</label>
      <input type="range" id="width" min="50" max="200" value="90" step="1">
    </div>
    <div class="control-group">
      <label for="height">Height</label>
      <input type="range" id="height" min="50" max="200" value="100" step="1">
    </div>
    <div class="control-group">
      <label for="scale">Uniform Scale</label>
      <input type="range" id="scale" min="0.5" max="2.0" value="1.0" step="0.01">
    </div>
    <div class="control-group">
      <label for="fillColor">Fill Color</label>
      <input type="color" id="fillColor" value="#1e1e1e">
    </div>
  </div>

  <div class="measurement" id="measurementDisplay">Total Measurement: 0</div>

  <div class="zoom-buttons">
    <button class="zoom-button" id="zoomIn"><i class="fas fa-plus"></i></button>
    <button class="zoom-button" id="zoomOut"><i class="fas fa-minus"></i></button>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1e1e1e);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 0, 200);

    const renderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.getElementById('canvas') });
    renderer.setSize(window.innerWidth, window.innerHeight);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const group = new THREE.Group();
    scene.add(group);

    const patternPresets = {
      basic: [
        ["line", [[90, 0], [90, 40]]],
        ["bezier", [[90, 40], [90, 60], [63, 80], [45, 100]]],
        ["line", [[45, 100], [0, 100]]],
        ["line", [[0, 100], [0, 0]]],
        ["bezier", [[0, 0], [18, -40], [72, -40], [90, 0]]]
      ],
      shirtWithCollar: [
        ["line", [[90, 0], [90, 40]]],
        ["bezier", [[90, 40], [90, 60], [63, 80], [45, 100]]],
        ["line", [[45, 100], [0, 100]]],
        ["line", [[0, 100], [0, 40]]],
        ["bezier", [[0, 40], [18, -10], [72, -10], [90, 0]]]
      ],
      shirtWithSleeves: [
        // Shirt body
        ["line", [[90, 0], [90, 40]]],
        ["bezier", [[90, 40], [90, 60], [63, 80], [45, 100]]],
        ["line", [[45, 100], [0, 100]]],
        ["line", [[0, 100], [0, 0]]],
        ["bezier", [[0, 0], [18, -40], [72, -40], [90, 0]]],

        // Right sleeve (separate shape)
        ["break"],
        ["bezier", [[90, 40], [110, 30], [130, 60], [150, 50]]],
        ["line", [[150, 50], [160, 70]]],
        ["line", [[160, 70], [170, 90]]],
        ["line", [[170, 90], [160, 110]]],
        ["line", [[160, 110], [140, 120]]],
        ["line", [[140, 120], [130, 100]]],
        ["line", [[130, 100], [150, 100]]]
      ],
      shirtWithYoke: [
        // Shirt body with straight bottom
        ["line", [[90, 0], [90, 40]]],
        ["bezier", [[90, 40], [90, 60], [63, 80], [45, 100]]],
        ["line", [[45, 100], [0, 100]]],
        ["line", [[0, 100], [0, 40]]],
        ["line", [[0, 40], [45, 40]]],
        ["line", [[45, 40], [90, 40]]]
      ]
    };

    const generatePattern = (patternData, width, height, colorHex) => {
      group.clear();
      let shape = new THREE.Shape();
      let lastPoint = null;

      const addShape = (shp) => {
        if (shp && shp.getPoints().length > 1) {
          const geometry = new THREE.ShapeGeometry(shp);
          const fill = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({
            color: new THREE.Color(colorHex),
            side: THREE.DoubleSide
          }));
          group.add(fill);

          const edgeGeo = new THREE.EdgesGeometry(geometry);
          const edgeMat = new THREE.LineBasicMaterial({ color: 0xffffff });
          const edgeLines = new THREE.LineSegments(edgeGeo, edgeMat);
          group.add(edgeLines);
        }
      };

      patternData.forEach((segment) => {
        if (segment[0] === "break") {
          addShape(shape);
          shape = new THREE.Shape();
          lastPoint = null;
          return;
        }

        const scaled = segment[1].map(p => new THREE.Vector2(p[0] * (width / 100), p[1] * (height / 100)));
        const start = scaled[0];

        if (!lastPoint || !lastPoint.equals(start)) {
          shape.moveTo(start.x, start.y);
        }

        if (segment[0] === "line") {
          shape.lineTo(scaled[1].x, scaled[1].y);
          lastPoint = scaled[1];
        } else if (segment[0] === "bezier") {
          shape.bezierCurveTo(scaled[1].x, scaled[1].y, scaled[2].x, scaled[2].y, scaled[3].x, scaled[3].y);
          lastPoint = scaled[3];
        }
      });

      addShape(shape);

      const totalMeasurement = calculateTotalMeasurement(patternData, width, height);
      document.getElementById('measurementDisplay').textContent = `Total Measurement: ${totalMeasurement.toFixed(2)} cm`;
    };

    const calculateTotalMeasurement = (patternData, width, height) => {
      let total = 0;
      patternData.forEach((segment) => {
        if (segment[0] === "break") return;
        const scaledPoints = segment[1].map(p => new THREE.Vector2(p[0] * (width / 100), p[1] * (height / 100)));
        for (let i = 1; i < scaledPoints.length; i++) {
          total += scaledPoints[i].distanceTo(scaledPoints[i - 1]);
        }
      });
      return total;
    };

    const patternSelect = document.getElementById('patternPreset');
    const widthSlider = document.getElementById('width');
    const heightSlider = document.getElementById('height');
    const scaleSlider = document.getElementById('scale');
    const colorInput = document.getElementById('fillColor');

    function updatePattern() {
      const patternName = patternSelect.value;
      const patternData = patternPresets[patternName];
      let width = parseFloat(widthSlider.value);
      let height = parseFloat(heightSlider.value);
      const scale = parseFloat(scaleSlider.value);
      const fillColor = colorInput.value;

      if (scale !== 1.0) {
        width *= scale;
        height *= scale;
      }

      generatePattern(patternData, width, height, fillColor);
    }

    patternSelect.addEventListener('change', updatePattern);
    widthSlider.addEventListener('input', updatePattern);
    heightSlider.addEventListener('input', updatePattern);
    scaleSlider.addEventListener('input', updatePattern);
    colorInput.addEventListener('input', updatePattern);

    const zoomInButton = document.getElementById('zoomIn');
    const zoomOutButton = document.getElementById('zoomOut');

    zoomInButton.addEventListener('click', () => {
      camera.position.z -= 10;
    });

    zoomOutButton.addEventListener('click', () => {
      camera.position.z += 10;
    });

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    updatePattern();

    const animate = () => {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    };

    animate();
  </script>
</body>
</html>